#!/bin/bash
# –ì–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Home Assistant

set -euo pipefail

SCRIPT_DIR="/home/gfer/HASSio/scripts"

show_menu() {
    echo ""
    echo "üè† Home Assistant - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ"
    echo "==============================="
    echo ""
    echo "  1) ‚öôÔ∏è  –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã"
    echo "  2) üîå –°–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥–∏"
    echo "  3) üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å"
    echo "  4) üöÄ –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è"
    echo "  5) üíæ –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø"
    echo "  6) üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞"
    echo "  7) üìã –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤"
    echo "  8) üî¨ –ó–∞–ø—É—Å–∫ –∞—É–¥–∏—Ç–∞"
    echo "  9) üìù –ü—Ä–æ–≤–µ—Ä–∏—Ç—å YAML"
    echo " 10) üìö –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é"
    echo " 11) üîå –†–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å"
    echo "  0) ‚ùå –í—ã—Ö–æ–¥"
    echo ""
}

while true; do
    show_menu
    read -p "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ (0-11): " -r choice
    echo ""
    echo ""

    case $choice in
        1)
            echo "‚öôÔ∏è  –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã..."
            "${SCRIPT_DIR}/configure.sh"
            ;;
        2)
            echo "üîå –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ..."
            sudo "${SCRIPT_DIR}/mount.sh"
            ;;
        3)
            echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞..."
            "${SCRIPT_DIR}/check.sh"
            ;;
        4)
            echo "üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π..."
            "${SCRIPT_DIR}/deploy.sh"
            ;;
        5)
            echo "üíæ –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞..."
            "${SCRIPT_DIR}/backup.sh"
            ;;
        6)
            echo "üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ..."
            "${SCRIPT_DIR}/restore.sh"
            ;;
        7)
            echo "üìã –õ–æ–≥–∏..."
            "${SCRIPT_DIR}/view_logs.sh"
            ;;
        8)
            echo "üî¨ –ó–∞–ø—É—Å–∫ –∞—É–¥–∏—Ç–∞..."
            "${SCRIPT_DIR}/audit.sh"
            ;;
        9)
            echo "üìù –ü—Ä–æ–≤–µ—Ä–∫–∞ YAML —Ñ–∞–π–ª–æ–≤..."
            INTERACTIVE_MODE=1 "${SCRIPT_DIR}/validate_yaml.sh"
            ;;
        10)
            echo "üìö –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏..."
            python3 "${SCRIPT_DIR}/validate_docs.py" || true
            ;;
        11)
            echo "üîå –†–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ..."
            sudo umount /mnt/hassio 2>/dev/null && echo "‚úÖ –†–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ" || echo "‚ö†Ô∏è  –ù–µ –±—ã–ª–æ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ"
            rm -f /home/gfer/HASSio/config 2>/dev/null
            ;;
        0)
            echo "üëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!"
            exit 0
            ;;
        *)
            echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä"
            ;;
    esac

    echo ""
    read -r -p "–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è..."
done
