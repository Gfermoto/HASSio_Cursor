# ⚠️ NVIDIA на Proxmox - Известная проблема

## Проблема

При попытке установки NVIDIA драйверов из Debian репозиториев на Proxmox возникает конфликт:

```text
W: (pve-apt-hook) You are attempting to remove the meta-package 'proxmox-ve'!
E: Sub-process /usr/share/proxmox-ve/pve-apt-hook returned an error code (1)
```

**Причина:** Конфликт зависимостей между `nvidia-driver` и `proxmox-ve` metapackage в Debian 12 Bookworm.

---

## ⚠️ ВНИМАНИЕ

**НЕ продолжайте установку** если видите предупреждение об удалении `proxmox-ve`!

Удаление `proxmox-ve` может:
- Нарушить обновления Proxmox
- Удалить критичные компоненты
- Сделать систему нестабильной

---

## Безопасные решения

### Решение 1: Официальный NVIDIA .run installer (рекомендуется)

**Плюсы:**
- ✅ Не конфликтует с proxmox-ve
- ✅ Последние версии драйверов
- ✅ DKMS support (автоперекомпиляция при обновлении ядра)

**Минусы:**
- ⚠️ Ручное обновление драйверов
- ⚠️ Требует build-essential и headers

**Статус:** Требует тестирования на вашей конфигурации.  
**Риск:** Средний (может не загрузиться система, но recoverable)

### Решение 2: Использовать VM вместо LXC

**Плюсы:**
- ✅ Полная изоляция
- ✅ PCI passthrough GPU без драйверов на хосте
- ✅ Нет конфликтов с Proxmox

**Минусы:**
- ❌ Требует IOMMU и VT-d в BIOS
- ❌ GPU выделяется только одной VM
- ❌ Больше overhead (~10-15%)

**Статус:** Работоспособно, но сложнее.  
**Риск:** Низкий (VM изолирована)

### Решение 3: Proxmox на bare metal без Ollama, Ollama на отдельной VM/машине

**Плюсы:**
- ✅ Нет рисков для Proxmox
- ✅ Простая установка Ollama на чистой Ubuntu
- ✅ Сетевой доступ к Ollama API

**Минусы:**
- ❌ Требует дополнительное железо или VM

**Статус:** Самое безопасное решение.  
**Риск:** Нулевой для Proxmox

### Решение 4: Использовать облачные LLM (GigaChat, YandexGPT)

**Плюсы:**
- ✅ Нет рисков для инфраструктуры
- ✅ Не требует GPU
- ✅ Бесплатные квоты

**Минусы:**
- ❌ Требует интернет
- ❌ Данные уходят в облако

**Статус:** Работает сейчас, без установки.  
**Риск:** Нулевой

---

## Рекомендация

**Для production Proxmox системы рекомендую:**

1. **Не рисковать** Proxmox хостом с NVIDIA драйверами
2. **Использовать GigaChat** для n8n интеграций (у вас уже работает)
3. **Если критично нужен локальный AI:**
   - Вариант A: Установить Ollama на отдельной Ubuntu VM в Proxmox (без драйверов на хосте)
   - Вариант B: Установить Ollama на отдельной физической машине
   - Вариант C: Протестировать официальный .run installer на тестовом Proxmox

---

## Что я НЕ рекомендую

❌ Продолжать установку с удалением `proxmox-ve`  
❌ Использовать `--force` или обход pve-apt-hook  
❌ Экспериментировать на production Proxmox без backup

---

## Следующие шаги

**Вариант 1 (безопасный):**
Продолжите использовать GigaChat - он уже работает у вас без проблем.

**Вариант 2 (тестирование):**
Если у вас есть тестовый Proxmox или snapshot системы - можем протестировать официальный NVIDIA installer.

**Вариант 3 (VM):**
Создадим Ubuntu VM в Proxmox с PCI passthrough GPU (без драйверов на хосте).

**Какой вариант предпочитаете?**

---

**Автор:** AI Assistant  
**Дата:** Октябрь 2025  
**Статус:** ⚠️ Требует решения от пользователя

