# ü§µ AI –î–≤–æ—Ä–µ—Ü–∫–∏–π: –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ AI –¥–≤–æ—Ä–µ—Ü–∫–æ–≥–æ —Å –≥–æ–ª–æ—Å–æ–≤—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏.

–û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –≤–∞—à–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: **NVIDIA P106-100 (6GB)** + **Ollama** + **n8n**.

---

## üéØ –ß—Ç–æ –ø–æ–ª—É—á–∏–º

### ü§µ AI –î–≤–æ—Ä–µ—Ü–∫–∏–π

- Telegram –±–æ—Ç (—Ç–µ–∫—Å—Ç + –≥–æ–ª–æ—Å)
- –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —è–∑—ã–∫: "–î–æ–º–∞ —Ö–æ–ª–æ–¥–Ω–æ" ‚Üí –¥–µ–π—Å—Ç–≤–∏–µ
- –ü–æ–Ω–∏–º–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç 15 –∑–æ–Ω –æ—Ç–æ–ø–ª–µ–Ω–∏—è

### üìä –ê–Ω–∞–ª–∏—Ç–∏–∫ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

- –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö
- –û—Ç—á–µ—Ç—ã —Å YAML —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏
- –í—ã –ø–∏—à–µ—Ç–µ –∫–æ–¥ –≤ Cursor

### üéôÔ∏è –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **STT** (Speech-to-Text): Whisper, —Ä—É—Å—Å–∫–∏–π
- **TTS** (Text-to-Speech): –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ

---

## ‚úÖ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

**–ñ–µ–ª–µ–∑–æ:**

- Proxmox —Å–µ—Ä–≤–µ—Ä
- **NVIDIA P106-100 (6GB)** –∏–ª–∏ GTX 1060 8GB
- CPU: 4+ cores, RAM: 16+ GB

**–°–æ—Ñ—Ç:**

- Proxmox VE 7.0+
- Home Assistant (192.168.1.20)
- n8n (Docker)
- Telegram –±–æ—Ç

---

## üöÄ –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Ollama + GPU

### 1.1. –°–æ–∑–¥–∞—Ç—å VM –Ω–∞ Proxmox

```bash
# CLI –∫–æ–º–∞–Ω–¥—ã –Ω–∞ Proxmox —Ö–æ—Å—Ç–µ
qm create 200 --name ollama-ai --memory 8192 --cores 4
```

### 1.2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Ubuntu 22.04

–°–∫–∞—á–∞—Ç—å –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Ubuntu Server 22.04 –Ω–∞ VM 200.

### 1.3. –ü—Ä–æ–±—Ä–æ—Å–∏—Ç—å GPU

**Proxmox Web UI:** VM 200 ‚Üí Hardware ‚Üí Add ‚Üí PCI Device ‚Üí NVIDIA P106-100

**CLI:**

```bash
qm set 200 -hostpci0 01:00,pcie=1
```

### 1.4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å NVIDIA –¥—Ä–∞–π–≤–µ—Ä—ã

**SSH –≤ VM:**

```bash
apt update && apt upgrade -y
apt install -y nvidia-driver-535
reboot
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**

```bash
nvidia-smi
# –î–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É —Å P106-100
```

### 1.5. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Ollama

```bash
curl -fsSL https://ollama.com/install.sh | sh

# –û—Ç–∫—Ä—ã—Ç—å –¥–æ—Å—Ç—É–ø –∏–∑ —Å–µ—Ç–∏
mkdir -p /etc/systemd/system/ollama.service.d
cat > /etc/systemd/system/ollama.service.d/override.conf << 'EOF'
[Service]
Environment="OLLAMA_HOST=0.0.0.0:11434"
Environment="OLLAMA_KEEP_ALIVE=24h"
EOF

systemctl daemon-reload
systemctl restart ollama
```

**–£–∑–Ω–∞—Ç—å IP:** `hostname -I` (–Ω–∞–ø—Ä–∏–º–µ—Ä: 192.168.1.51)

---

## üß† –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ AI –º–æ–¥–µ–ª–µ–π

**SSH –≤ Ollama VM:**

```bash
# Llama 3 (8B) - –¥–≤–æ—Ä–µ—Ü–∫–∏–π + –∞–Ω–∞–ª–∏—Ç–∏–∫
ollama pull llama3:8b-instruct-q4_0

# Whisper - —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –≥–æ–ª–æ—Å–∞
ollama pull whisper:base

# –ü—Ä–æ–≤–µ—Ä–∫–∞
ollama list
```

**VRAM:** ~5.2 GB (–æ–±–µ –º–æ–¥–µ–ª–∏ –≤–ª–µ–∑—É—Ç –≤ 6GB!)

---

## üîß –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ n8n

### 3.1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ n8n

```bash
mkdir -p /opt/n8n && cd /opt/n8n
cat > docker-compose.yml << 'EOF'
version: '3.8'
services:
  n8n:
    image: n8nio/n8n:latest
    ports:
      - "5678:5678"
    environment:
      - N8N_HOST=192.168.1.50
      - GENERIC_TIMEZONE=Europe/Moscow
    volumes:
      - n8n_data:/home/node/.n8n
volumes:
  n8n_data:
EOF

docker-compose up -d
```

**–û—Ç–∫—Ä—ã—Ç—å:** <http://192.168.1.50:5678>

### 3.2. –°–æ–∑–¥–∞—Ç—å Telegram –±–æ—Ç–∞

1. –ù–∞–π—Ç–∏ –≤ Telegram: `@BotFather`
2. `/newbot` ‚Üí –∏–º—è ‚Üí username
3. –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω

### 3.3. Credentials –≤ n8n

**Telegram:**
- Name: Telegram Bot
- Access Token: [—Ç–æ–∫–µ–Ω –æ—Ç BotFather]

**Home Assistant:**
- Host: <http://192.168.1.20:8123>
- Access Token: [—Å–æ–∑–¥–∞—Ç—å –≤ HA Profile ‚Üí Security]

---

## ü§µ –®–∞–≥ 4: Workflow –î–≤–æ—Ä–µ—Ü–∫–∏–π

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ workflow

1. **Telegram Trigger** - –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
2. **Filter** - —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∏–ª–∏ –≥–æ–ª–æ—Å–æ–≤—ã–µ
3. **Whisper STT** (–µ—Å–ª–∏ –≥–æ–ª–æ—Å) - –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ —Ç–µ–∫—Å—Ç
4. **AI Agent (Llama 3)** - –ø–æ–Ω–∏–º–∞–Ω–∏–µ + –¥–µ–π—Å—Ç–≤–∏–µ
5. **Home Assistant API** - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥
6. **Telegram Reply** - –æ—Ç–≤–µ—Ç

### System Prompt –¥–ª—è Llama 3

```text
–¢—ã –¥–≤–æ—Ä–µ—Ü–∫–∏–π —É–º–Ω–æ–≥–æ –¥–æ–º–∞ —Å 15 –∑–æ–Ω–∞–º–∏ –æ—Ç–æ–ø–ª–µ–Ω–∏—è.

–°—Ç–∏–ª—å: –≤–µ–∂–ª–∏–≤—ã–π, –∫—Ä–∞—Ç–∫–∏–π, –æ–±—ä—è—Å–Ω—è–µ—à—å WHY.

Tools:
- get_all_zones() - —Å—Ç–∞—Ç—É—Å –∑–æ–Ω
- set_zone_temperature(zone, temp) - –∏–∑–º–µ–Ω–∏—Ç—å

–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ:
1. –ü–æ–ª—É—á–∏ —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
2. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π
3. –ü—Ä–µ–¥–ª–æ–∂–∏ —Ä–µ—à–µ–Ω–∏–µ + —Ä–∞—Å—á–µ—Ç—ã
4. –°–ø—Ä–æ—Å–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–ª—è –±–æ–ª—å—à–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ü—Ä–∏–º–µ—Ä:
üë§: –î–æ–º–∞ —Ö–æ–ª–æ–¥–Ω–æ
ü§µ: –°—Ä–µ–¥–Ω—è—è 19¬∞C (–Ω–æ—Ä–º–∞ 21¬∞C). –ù–∞ —É–ª–∏—Ü–µ -5¬∞C.
    –ü–æ–≤—ã—à–∞—é –¥–æ 22¬∞C –≤ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∑–æ–Ω–∞—Ö.
    –í—Ä–µ–º—è ~25 –º–∏–Ω, —Å—Ç–æ–∏–º–æ—Å—Ç—å ~15‚ÇΩ. –ü—Ä–∏–º–µ–Ω–∏—Ç—å?
```

**–î–µ—Ç–∞–ª–∏ workflow —Å–º. –≤:** [n8n-ai-agents.md](./n8n-ai-agents.md)

---

## üéôÔ∏è –®–∞–≥ 5: –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

### Workflow –¥–ª—è STT

1. **Telegram Trigger** (voice filter)
2. **Download Audio** - —Å–∫–∞—á–∞—Ç—å OGG
3. **Whisper API** - <http://192.168.1.51:11434/api/generate>
4. **Extract Text** - –ø–æ–ª—É—á–∏—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
5. **‚Üí –û—Å–Ω–æ–≤–Ω–æ–π workflow –¥–≤–æ—Ä–µ—Ü–∫–æ–≥–æ**

**–°–∫–æ—Ä–æ—Å—Ç—å:** ~5 —Å–µ–∫ –Ω–∞ –≥–æ–ª–æ—Å–æ–≤–æ–µ 30 —Å–µ–∫

---

## üìä –®–∞–≥ 6: –ê–Ω–∞–ª–∏—Ç–∏–∫ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

### Workflow

1. **Cron** - –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ 20:00
2. **HA History API** - –¥–∞–Ω–Ω—ã–µ –∑–∞ 7 –¥–Ω–µ–π
3. **Aggregate** - –∞–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ –∑–æ–Ω–∞–º
4. **AI Analyst (Llama 3)** - –∞–Ω–∞–ª–∏–∑ + —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
5. **Save Report** - Markdown —Ñ–∞–π–ª
6. **Telegram** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û—Ç—á–µ—Ç —Å –≥–æ—Ç–æ–≤—ã–º YAML –∫–æ–¥–æ–º –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–π.

---

## üîä –®–∞–≥ 7: TTS (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Piper TTS

```bash
wget https://github.com/rhasspy/piper/releases/download/v1.2.0/piper_amd64.tar.gz
tar -xzf piper_amd64.tar.gz && mv piper /usr/local/bin/

# –†—É—Å—Å–∫–∞—è –º–æ–¥–µ–ª—å
mkdir -p /opt/piper/models && cd /opt/piper/models
wget https://huggingface.co/rhasspy/piper-voices/resolve/main/ru/ru_RU/dmitri/medium/ru_RU-dmitri-medium.onnx
```

**API –¥–ª—è n8n:** Flask app –Ω–∞ –ø–æ—Ä—Ç—É 5000

---

## ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ–∫—Å—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

```text
üë§: –ü—Ä–∏–≤–µ—Ç
ü§µ: –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø –≤–∞—à –¥–≤–æ—Ä–µ—Ü–∫–∏–π. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?

üë§: –ö–∞–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞?
ü§µ: –°—Ä–µ–¥–Ω—è—è 20.5¬∞C. –ì–æ—Å—Ç–∏–Ω–∞—è 21¬∞C, —Å–ø–∞–ª—å–Ω—è 20¬∞C. –í—Å—ë –≤ –Ω–æ—Ä–º–µ!

üë§: –î–æ–º–∞ —Ö–æ–ª–æ–¥–Ω–æ
ü§µ: –°—Ä–µ–¥–Ω—è—è 19¬∞C. –†–µ–∫–æ–º–µ–Ω–¥—É—é –ø–æ–≤—ã—Å–∏—Ç—å –¥–æ 22¬∞C.
    –í—Ä–µ–º—è ~25 –º–∏–Ω, —Å—Ç–æ–∏–º–æ—Å—Ç—å ~15‚ÇΩ. –ü—Ä–∏–º–µ–Ω–∏—Ç—å?

üë§: –î–∞
ü§µ: ‚úÖ –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã. –ü—Ä–æ–≥—Ä–µ–≤ –Ω–∞—á–∞—Ç.
```

### –ì–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

```text
üéôÔ∏è "–î–æ–º–∞ —Ö–æ–ª–æ–¥–Ω–æ, —Å–¥–µ–ª–∞–π –ø–æ—Ç–µ–ø–ª–µ–µ"
   ‚Üì (~5 —Å–µ–∫)
üì± –ü–æ–≤—ã—à–∞—é –¥–æ 22¬∞C –≤ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∑–æ–Ω–∞—Ö. ‚úÖ
```

---

## üêõ Troubleshooting

**Ollama –Ω–µ –≤–∏–¥–∏—Ç GPU:**

```bash
nvidia-smi  # GPU –≤–∏–¥–Ω–∞?
systemctl restart ollama
```

**–ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞:**

```bash
nvidia-smi  # VRAM ~5GB?
ollama ps  # –ú–æ–¥–µ–ª–∏ –≤ –ø–∞–º—è—Ç–∏?
```

**Whisper –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç —Ä—É—Å—Å–∫–∏–π:**

```bash
ollama rm whisper:base
ollama pull whisper:base
```

---

## üìã –ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- ‚úÖ P106-100 –ø—Ä–æ–±—Ä–æ—à–µ–Ω–∞ –≤ VM
- ‚úÖ nvidia-smi –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç GPU
- ‚úÖ Ollama —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- ‚úÖ Llama 3 + Whisper —Å–∫–∞—á–∞–Ω—ã
- ‚úÖ n8n —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- ‚úÖ Telegram –±–æ—Ç —Å–æ–∑–¥–∞–Ω
- ‚úÖ Workflows —Å–æ–∑–¥–∞–Ω—ã –∏ –∞–∫—Ç–∏–≤–Ω—ã
- ‚úÖ –¢–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã

---

**–ì–æ—Ç–æ–≤–æ! –î–≤–æ—Ä–µ—Ü–∫–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç!** ü§µ‚ú®

**–î–µ—Ç–∞–ª–∏ workflow:** —Å–º. [n8n-ai-agents.md](./n8n-ai-agents.md)

**–í–æ–ø—Ä–æ—Å—ã:** [GitHub Issues](https://github.com/Gfermoto/HASSio_Cursor/issues)
