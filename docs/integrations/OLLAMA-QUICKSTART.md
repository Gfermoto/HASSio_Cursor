# Ollama –Ω–∞ Proxmox —Å GPU - –ü–æ—à–∞–≥–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

–ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é Ollama –≤ LXC –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –Ω–∞ Proxmox VE —Å NVIDIA GPU –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ AI.

**–í—Ä–µ–º—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏:** 20-30 –º–∏–Ω—É—Ç  
**–£—Ä–æ–≤–µ–Ω—å:** Intermediate (—Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã —Å Linux –∏ Proxmox)

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–¢–µ–∫—É—â–µ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ:**
- Proxmox VE (–ª—é–±–∞—è –≤–µ—Ä—Å–∏—è 7.x / 8.x)
- NVIDIA GTX 1050 Ti (4GB VRAM)
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –º–æ–¥–µ–ª—å: `phi3:mini` (2.3GB)

**–ü–æ—Å–ª–µ –∞–ø–≥—Ä–µ–π–¥–∞ –Ω–∞ GTX 1060:**
- VRAM: 6GB
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –º–æ–¥–µ–ª—å: `llama3.1:8b` (4.7GB)

---

## –®–∞–≥ 1: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Proxmox —Ö–æ—Å—Ç—É

```bash
ssh root@<PROXMOX_IP>
```

–ó–∞–º–µ–Ω–∏—Ç–µ `<PROXMOX_IP>` –Ω–∞ IP –∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ Proxmox —Å–µ—Ä–≤–µ—Ä–∞.

---

## –®–∞–≥ 2: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –¥–ª—è NVIDIA –¥—Ä–∞–π–≤–µ—Ä–æ–≤

Proxmox —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Debian —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ —Å non-free –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–æ–ø—Ä–∏–µ—Ç–∞—Ä–Ω—ã—Ö NVIDIA –¥—Ä–∞–π–≤–µ—Ä–æ–≤.

### 2.1 –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤

```bash
wget https://raw.githubusercontent.com/Gfermoto/HASSio_Cursor/main/docs/integrations/fix-proxmox-nvidia-repos.sh
chmod +x fix-proxmox-nvidia-repos.sh
```

### 2.2 –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞

```bash
./fix-proxmox-nvidia-repos.sh
```

–°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç:
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ Debian (bookworm/bullseye)
- –°–æ–∑–¥–∞–Ω–∏–µ backup —Ç–µ–∫—É—â–µ–≥–æ sources.list
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ main, contrib, non-free, non-free-firmware –≤ sources.list
- –û—Ç–∫–ª—é—á–µ–Ω–∏–µ enterprise —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (—Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É)
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ –ø–∞–∫–µ—Ç–æ–≤ (apt update)
- –ü–æ–∏—Å–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–µ—Ä—Å–∏–π NVIDIA –¥—Ä–∞–π–≤–µ—Ä–æ–≤
- –£—Å—Ç–∞–Ω–æ–≤–∫—É –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ (535+)
- –£—Å—Ç–∞–Ω–æ–≤–∫—É pve-headers –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —è–¥—Ä–∞
- –ù–∞—Å—Ç—Ä–æ–π–∫—É blacklist –¥–ª—è nouveau –¥—Ä–∞–π–≤–µ—Ä–∞
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ initramfs

–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤–≤–µ–¥–∏—Ç–µ: `y`

### 2.3 –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Ö–æ—Å—Ç–∞

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞:

```bash
reboot
```

–•–æ—Å—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—Å—è (~1-2 –º–∏–Ω—É—Ç—ã).

---

## –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ NVIDIA –¥—Ä–∞–π–≤–µ—Ä–∞

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Ö–æ—Å—Ç—É:

```bash
ssh root@<PROXMOX_IP>
```

–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥—Ä–∞–π–≤–µ—Ä–∞:

```bash
nvidia-smi
```

–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
```text
+-----------------------------------------------------------------------------+
| NVIDIA-SMI 535.xxx      Driver Version: 535.xxx      CUDA Version: 12.2    |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
|   0  GeForce GTX 105...  Off  | 00000000:01:00.0 Off |                  N/A |
+-----------------------------------------------------------------------------+
```

–ü—Ä–æ–≤–µ—Ä–∫–∞ device nodes:

```bash
ls -la /dev/nvidia*
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∏–¥–Ω—ã: `nvidia0`, `nvidiactl`, `nvidia-uvm`, `nvidia-modeset`

---

## –®–∞–≥ 4: –°–æ–∑–¥–∞–Ω–∏–µ LXC –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å Ollama

### 4.1 –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```bash
wget https://raw.githubusercontent.com/Gfermoto/HASSio_Cursor/main/docs/integrations/ollama-proxmox-install.sh
chmod +x ollama-proxmox-install.sh
```

### 4.2 –ó–∞–ø—É—Å–∫ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```bash
./ollama-proxmox-install.sh --create-lxc
```

–°–∫—Ä–∏–ø—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:

```text
CT ID [200]: 200
Hostname [ollama]: ollama
Password: <–≤–≤–µ–¥–∏—Ç–µ_–Ω–∞–¥–µ–∂–Ω—ã–π_–ø–∞—Ä–æ–ª—å>
Storage [local-lvm]: local-lvm
Disk size GB [50]: 50
Memory MB [8192]: 8192
Cores [4]: 4
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –°–æ–∑–¥–∞—Å—Ç –ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π LXC –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä Ubuntu 24.04
2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç major/minor –Ω–æ–º–µ—Ä–∞ NVIDIA —É—Å—Ç—Ä–æ–π—Å—Ç–≤
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç GPU passthrough –≤ `/etc/pve/lxc/200.conf`
4. –ó–∞–ø—É—Å—Ç–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
5. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç NVIDIA Container Toolkit –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
6. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç Ollama
7. –ù–∞—Å—Ç—Ä–æ–∏—Ç systemd —Å–µ—Ä–≤–∏—Å –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
8. –í—ã–≤–µ–¥–µ—Ç IP –∞–¥—Ä–µ—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

–ó–∞–ø–∏—à–∏—Ç–µ IP –∞–¥—Ä–µ—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏–∑ –≤—ã–≤–æ–¥–∞ —Å–∫—Ä–∏–ø—Ç–∞.

---

## –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã Ollama

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–∞:

```bash
pct exec 200 -- systemctl status ollama.service
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `active (running)`

–ü—Ä–æ–≤–µ—Ä–∫–∞ API endpoint:

```bash
CONTAINER_IP=$(pct exec 200 -- hostname -I | awk '{print $1}')
curl "http://$CONTAINER_IP:11434/api/tags"
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: `{"models":[]}`

---

## –®–∞–≥ 6: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–¥–µ–ª–∏

### 6.1 –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–æ–¥–µ–ª–∏

```bash
./ollama-proxmox-install.sh --install-model
```

### 6.2 –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏

–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ `CT ID:` –≤–≤–µ–¥–∏—Ç–µ: `200`

–ü—Ä–∏ –≤—ã–±–æ—Ä–µ –º–æ–¥–µ–ª–∏ –¥–ª—è GTX 1050 Ti (4GB) –≤—ã–±–µ—Ä–∏—Ç–µ: `1` (phi3:mini)

–°–∫—Ä–∏–ø—Ç —Å–∫–∞—á–∞–µ—Ç –º–æ–¥–µ–ª—å (~2.3GB) –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å.

---

## –®–∞–≥ 7: –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã

–ó–∞–ø—É—Å–∫ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏:

```bash
./ollama-proxmox-install.sh --check
```

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç:
- GPU device nodes –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- –°—Ç–∞—Ç—É—Å ollama.service
- –°–ø–∏—Å–æ–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API

–í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–π—Ç–∏ —É—Å–ø–µ—à–Ω–æ.

---

## –®–∞–≥ 8: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏

–í—Ö–æ–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:

```bash
pct enter 200
```

–¢–µ—Å—Ç –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ CLI:

```bash
ollama run phi3:mini "–ü—Ä–∏–≤–µ—Ç! –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Å—è –∫—Ä–∞—Ç–∫–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ –∫–∞–∫ AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç"
```

–ú–æ–¥–µ–ª—å –¥–æ–ª–∂–Ω–∞ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.

–í—ã—Ö–æ–¥ –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

```bash
exit
```

–¢–µ—Å—Ç API —Å —Ö–æ—Å—Ç–∞:

```bash
CONTAINER_IP=$(pct exec 200 -- hostname -I | awk '{print $1}')

curl "http://$CONTAINER_IP:11434/api/generate" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "phi3:mini",
    "prompt": "–ü—Ä–∏–≤–µ—Ç! –û—Ç–≤–µ—Ç—å –∫—Ä–∞—Ç–∫–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º",
    "stream": false
  }'
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å JSON —Å –ø–æ–ª–µ–º `response` —Å–æ–¥–µ—Ä–∂–∞—â–∏–º –æ—Ç–≤–µ—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º.

---

## –®–∞–≥ 9: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å n8n

### 9.1 –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ workflow

–°–∫–∞—á–∞–π—Ç–µ workflow –∏–∑ GitHub:

```bash
wget https://raw.githubusercontent.com/Gfermoto/HASSio_Cursor/main/docs/integrations/n8n-voice-assistant-ollama.json
```

### 9.2 –ò–º–ø–æ—Ä—Ç –≤ n8n

1. –û—Ç–∫—Ä–æ–π—Ç–µ n8n Web UI
2. –ù–∞–∂–º–∏—Ç–µ **Workflows** ‚Üí **Import from File**
3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª `n8n-voice-assistant-ollama.json`
4. Workflow –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω —Å 16 —É–∑–ª–∞–º–∏

### 9.3 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —É–∑–ª—ã:

**–£–∑–µ–ª "Ollama: Model":**
- –ü–∞—Ä–∞–º–µ—Ç—Ä `baseURL`: `http://<CONTAINER_IP>:11434`
- –ü–∞—Ä–∞–º–µ—Ç—Ä `model`: `phi3:mini`

**–£–∑–µ–ª "HA: Get All States":**
- –ü–∞—Ä–∞–º–µ—Ç—Ä `url`: `http://<HA_IP>:8123/api/states`
- Credential: —Å–æ–∑–¥–∞–π—Ç–µ HTTP Header Auth —Å `Authorization: Bearer <HA_TOKEN>`

**–£–∑–µ–ª "Telegram: Trigger":**
- –ü–∞—Ä–∞–º–µ—Ç—Ä `userIds`: –≤–∞—à Telegram ID (–ø–æ–ª—É—á–∏—Ç–µ —á–µ—Ä–µ–∑ @userinfobot)
- Credential: —Å–æ–∑–¥–∞–π—Ç–µ Telegram API —Å —Ç–æ–∫–µ–Ω–æ–º –æ—Ç @BotFather

### 9.4 –°–æ–∑–¥–∞–Ω–∏–µ Home Assistant credentials

–í n8n:

```text
Credentials ‚Üí Add Credential ‚Üí HTTP Header Auth
Name: Authorization
Value: Bearer <YOUR_HA_LONG_LIVED_TOKEN>
Credential Name: Home Assistant API
```

–ü–æ–ª—É—á–µ–Ω–∏–µ Home Assistant —Ç–æ–∫–µ–Ω–∞:
1. Home Assistant ‚Üí –ü—Ä–æ—Ñ–∏–ª—å (–ª–µ–≤—ã–π –Ω–∏–∂–Ω–∏–π —É–≥–æ–ª)
2. Scroll –≤–Ω–∏–∑ ‚Üí Long-Lived Access Tokens
3. Create Token ‚Üí Name: `n8n-ollama`
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω

### 9.5 –°–æ–∑–¥–∞–Ω–∏–µ Telegram credentials

–í n8n:

```text
Credentials ‚Üí Add Credential ‚Üí Telegram API
Access Token: <TOKEN_FROM_BOTFATHER>
Credential Name: Telegram Bot
```

–°–æ–∑–¥–∞–Ω–∏–µ Telegram –±–æ—Ç–∞:
1. –û—Ç–∫—Ä–æ–π—Ç–µ @BotFather –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ: `/newbot`
3. –£–∫–∞–∂–∏—Ç–µ –∏–º—è –∏ username
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω

–ü–æ–ª—É—á–µ–Ω–∏–µ –≤–∞—à–µ–≥–æ Telegram ID:
1. –û—Ç–∫—Ä–æ–π—Ç–µ @userinfobot –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–∞—à ID

### 9.6 –°–æ–∑–¥–∞–Ω–∏–µ Tool workflows

–î–ª—è —Ä–∞–±–æ—Ç—ã Agent –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å 5 sub-workflows. –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ [README-ollama-assistant.md](./README-ollama-assistant.md), —Ä–∞–∑–¥–µ–ª "–°–æ–∑–¥–∞–Ω–∏–µ Tool Workflows".

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä –¥–ª—è Tool "Turn On Light":

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π workflow
2. –î–æ–±–∞–≤—å—Ç–µ —É–∑–µ–ª HTTP Request:
   - Method: POST
   - URL: `http://<HA_IP>:8123/api/services/light/turn_on`
   - Authentication: HTTP Header Auth (Home Assistant API)
   - Body: `{"entity_id": "{{ $json.entity_id }}"}`
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ workflow
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ ID workflow –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä `workflowId` —É–∑–ª–∞ "Tool: Turn On Light"

–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö 4 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.

### 9.7 –ê–∫—Ç–∏–≤–∞—Ü–∏—è workflow

1. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≥–ª–∞–≤–Ω—ã–π workflow
2. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–º —Å–ø—Ä–∞–≤–∞ –≤–≤–µ—Ä—Ö—É
3. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram ‚Üí –Ω–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ: `/start`

–ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º.

---

## –®–∞–≥ 10: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

–û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

```text
/help
```

–î–æ–ª–∂–Ω–∞ –≤–µ—Ä–Ω—É—Ç—å—Å—è —Å–ø—Ä–∞–≤–∫–∞.

```text
–í–∫–ª—é—á–∏ —Å–≤–µ—Ç –Ω–∞ –∫—É—Ö–Ω–µ
```

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å entity `light.kitchen`, –±–æ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç –∫–æ–º–∞–Ω–¥—É.

```text
–ö–∞–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞?
```

–ë–æ—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç –¥–∞–Ω–Ω—ã–µ —Å–µ–Ω—Å–æ—Ä–æ–≤ –∏–∑ Home Assistant.

---

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**GTX 1050 Ti + phi3:mini:**
- Latency (cold start): 3-5 —Å–µ–∫—É–Ω–¥
- Latency (warm): 1-2 —Å–µ–∫—É–Ω–¥—ã
- Throughput: 40-60 tokens/sec
- VRAM usage: ~2.5GB / 4GB

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ GPU:**

```bash
# –ù–∞ Proxmox —Ö–æ—Å—Ç–µ
watch -n 1 nvidia-smi

# –í–æ –≤—Ä–µ–º—è inference –¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:
# GPU-Util: 80-100%
# Memory-Usage: ~2500MB / 4096MB
```

---

## –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è

```bash
# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
pct status 200

# –°—Ç–∞—Ç—É—Å Ollama —Å–µ—Ä–≤–∏—Å–∞
pct exec 200 -- systemctl status ollama.service

# –°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π
pct exec 200 -- ollama list
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Ollama

```bash
pct enter 200
curl -fsSL https://ollama.ai/install.sh | sh
systemctl restart ollama.service
exit
```

### Backup –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```bash
# Snapshot –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
pct snapshot 200 "before-model-update-$(date +%Y%m%d)"

# Backup –≤ —Ñ–∞–π–ª
vzdump 200 --mode snapshot --storage local --compress gzip
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏

–ü–æ—Å–ª–µ –∞–ø–≥—Ä–µ–π–¥–∞ –Ω–∞ GTX 1060 (6GB):

```bash
pct enter 200
ollama pull llama3.1:8b
ollama list
exit
```

–û–±–Ω–æ–≤–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `model` –≤ n8n —É–∑–ª–µ "Ollama: Model" –Ω–∞ `llama3.1:8b`.

---

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: nvidia-smi –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –¥—Ä–∞–π–≤–µ—Ä–∞
dpkg -l | grep nvidia-driver

# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ nvidia-utils
DRIVER_VER=$(dpkg -l | grep nvidia-driver | awk '{print $2}' | grep -oP '\d+$')
apt install -y "nvidia-utils-$DRIVER_VER"
```

### –ü—Ä–æ–±–ª–µ–º–∞: GPU –Ω–µ –≤–∏–¥–µ–Ω –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

```bash
# –ù–∞ —Ö–æ—Å—Ç–µ: –ø—Ä–æ–≤–µ—Ä–∫–∞ device nodes
ls -la /dev/nvidia*

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
cat /etc/pve/lxc/200.conf | grep -A 10 "GPU Passthrough"

# –†–µ—Å—Ç–∞—Ä—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
pct stop 200
pct start 200

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
pct exec 200 -- ls -la /dev/nvidia*
```

### –ü—Ä–æ–±–ª–µ–º–∞: Ollama –º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è GPU
pct enter 200
ollama run phi3:mini "test" &
nvidia-smi

# GPU-Util –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å >80%
# –ï—Å–ª–∏ 0%, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
systemctl cat ollama.service | grep CUDA_VISIBLE_DEVICES
```

–ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞:

```bash
systemctl edit ollama.service
```

–î–æ–±–∞–≤—å—Ç–µ:
```ini
[Service]
Environment="CUDA_VISIBLE_DEVICES=0"
```

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ:

```bash
systemctl daemon-reload
systemctl restart ollama.service
exit
```

### –ü—Ä–æ–±–ª–µ–º–∞: n8n –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Ollama

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ Ollama —Å–ª—É—à–∞–µ—Ç –Ω–∞ 0.0.0.0
pct exec 200 -- ss -tlnp | grep 11434

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: 0.0.0.0:11434
# –ï—Å–ª–∏ 127.0.0.1:11434, –∏—Å–ø—Ä–∞–≤—å—Ç–µ:

pct exec 200 -- systemctl edit ollama.service
```

–î–æ–±–∞–≤—å—Ç–µ:
```ini
[Service]
Environment="OLLAMA_HOST=0.0.0.0:11434"
Environment="OLLAMA_ORIGINS=*"
```

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ:

```bash
pct exec 200 -- systemctl daemon-reload
pct exec 200 -- systemctl restart ollama.service
```

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ NVIDIA –¥—Ä–∞–π–≤–µ—Ä—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ Proxmox —Ö–æ—Å—Ç
2. ‚úÖ LXC –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ–∑–¥–∞–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
3. ‚úÖ Ollama –∑–∞–ø—É—â–µ–Ω —Å GPU support
4. ‚úÖ –ú–æ–¥–µ–ª—å phi3:mini –∑–∞–≥—Ä—É–∂–µ–Ω–∞
5. ‚úÖ API –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ —Å–µ—Ç–∏
6. ‚úÖ n8n workflow –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω
7. ‚úÖ Telegram –±–æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω
8. üîÑ –°–æ–∑–¥–∞–π—Ç–µ 5 Tool workflows –¥–ª—è Home Assistant
9. üîÑ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
10. üîÑ –ü–æ—Å–ª–µ –∞–ø–≥—Ä–µ–π–¥–∞ GPU —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ llama3.1:8b

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [OLLAMA-PROXMOX-SETUP.md](./OLLAMA-PROXMOX-SETUP.md) - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [README-ollama-assistant.md](./README-ollama-assistant.md) - –¥–µ—Ç–∞–ª–∏ n8n –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- [OLLAMA-SUMMARY.md](./OLLAMA-SUMMARY.md) - —Å–≤–æ–¥–∫–∞ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ—à–µ–Ω–∏–π

---

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!** –¢–µ–ø–µ—Ä—å —É –≤–∞—Å –ª–æ–∫–∞–ª—å–Ω—ã–π AI –¥–ª—è Home Assistant –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–±–ª–∞—á–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.
