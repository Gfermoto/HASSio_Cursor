# üó£Ô∏è –ì–æ–ª–æ—Å–æ–≤–æ–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è Home Assistant

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –≥–æ–ª–æ—Å–æ–≤–æ–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º Home Assistant —á–µ—Ä–µ–∑ Telegram. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ AI —Å–µ—Ä–≤–∏—Å—ã: Yandex SpeechKit, YandexGPT –∏ GigaChat.

---

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
- ‚úÖ **–°–≤–µ—Ç:** –≤–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ, —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∫–∞ —è—Ä–∫–æ—Å—Ç–∏
- ‚úÖ **–ö–ª–∏–º–∞—Ç:** —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã, —Å–º–µ–Ω–∞ —Ä–µ–∂–∏–º–æ–≤
- ‚úÖ **–°—Ü–µ–Ω—ã:** –∑–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–π
- ‚úÖ **–î–∞—Ç—á–∏–∫–∏:** –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π

### –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ **–ì–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã:** —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä—É—Å—Å–∫–æ–π —Ä–µ—á–∏
- ‚úÖ **–¢–µ–∫—Å—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã:** —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤–≤–æ–¥
- ‚úÖ **–ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞:** –ø–æ–º–Ω–∏—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ **–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —è–∑—ã–∫:** –ø–æ–Ω–∏–º–∞–µ—Ç –≤–∞—Ä–∏–∞—Ü–∏–∏ –∫–æ–º–∞–Ω–¥

### AI –º–æ–¥–µ–ª–∏
- ‚úÖ **YandexGPT** - –æ—Å–Ω–æ–≤–Ω–æ–π (–±—ã—Å—Ç—Ä—ã–π, –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –∫–≤–æ—Ç–∞)
- ‚úÖ **GigaChat** - —Ä–µ–∑–µ—Ä–≤–Ω—ã–π (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback)
- üîÑ **OLLAMA** - –≤ –ø–ª–∞–Ω–∞—Ö (–ª–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫)

---

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```text
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Telegram   ‚îÇ (—Ç–µ–∫—Å—Ç –∏–ª–∏ –≥–æ–ª–æ—Å)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Yandex STT   ‚îÇ (–µ—Å–ª–∏ –≥–æ–ª–æ—Å ‚Üí —Ç–µ–∫—Å—Ç)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ YandexGPT    ‚îÇ ‚Üê HA Tools (8 —Ñ—É–Ω–∫—Ü–∏–π)
‚îÇ + Memory     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚Üì (–µ—Å–ª–∏ –æ—à–∏–±–∫–∞)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  GigaChat    ‚îÇ ‚Üê HA Tools (fallback)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Home         ‚îÇ (–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥)
‚îÇ Assistant    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Telegram   ‚îÇ (–æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- **20+ —É–∑–ª–æ–≤** n8n
- **2 LLM** (YandexGPT + GigaChat)
- **8 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤** Home Assistant
- **Function calling** –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- **BufferWindowMemory** –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

---

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### API –∫–ª—é—á–∏

| –°–µ—Ä–≤–∏—Å | –ó–∞—á–µ–º | –ü–æ–ª—É—á–∏—Ç—å | –°—Ç–æ–∏–º–æ—Å—Ç—å |
|--------|-------|----------|-----------|
| **Yandex Cloud** | SpeechKit + YandexGPT | [–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è](./YANDEX-CLOUD-SETUP.md) | ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –∫–≤–æ—Ç–∞ |
| **GigaChat** | –†–µ–∑–µ—Ä–≤–Ω—ã–π LLM | [sberdevices.ru/gigachat](https://developers.sber.ru/portal/products/gigachat) | ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ |
| **Telegram Bot** | –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å | [@BotFather](https://t.me/BotFather) | ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ |
| **Home Assistant** | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ | –í–∞—à HA | ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ |

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **n8n** 1.0+ (—Å Langchain –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π)
- **Home Assistant** 2023.1+
- **Node.js** 18+ (–¥–ª—è n8n)

---

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á–∏

–°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏: [YANDEX-CLOUD-SETUP.md](./YANDEX-CLOUD-SETUP.md)

–í–∞–º –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è:
- ‚úÖ Yandex Cloud API Key
- ‚úÖ Yandex Folder ID
- ‚úÖ GigaChat Authorization Key (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç)
- ‚úÖ Telegram Bot Token

### –®–∞–≥ 2: –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ workflow

```bash
# –í n8n:
Workflows ‚Üí Import from File ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ n8n-voice-assistant.json
```

### –®–∞–≥ 3: –ó–∞–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

–û—Ç–∫—Ä–æ–π—Ç–µ workflow –∏ –∑–∞–º–µ–Ω–∏—Ç–µ –∑–∞–≥–ª—É—à–∫–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:

| –ó–∞–≥–ª—É—à–∫–∞ | –ì–¥–µ –∏—Å–∫–∞—Ç—å | –ß—Ç–æ –∑–∞–º–µ–Ω–∏—Ç—å |
|----------|------------|--------------|
| `YOUR_YANDEX_CLOUD_API_KEY` | –£–∑–ª—ã: "Yandex: SpeechKit STT", "YandexGPT: Chat" | –í–∞—à API Key |
| `YOUR_YANDEX_FOLDER_ID` | –£–∑–ª—ã: "Yandex: SpeechKit STT", "YandexGPT: Chat" | –í–∞—à Folder ID |
| `YOUR_GIGACHAT_AUTHORIZATION_KEY` | –£–∑–µ–ª: "GigaChat: Get Token" | Base64 –∫–ª—é—á |
| `YOUR_TELEGRAM_USER_ID` | –£–∑–µ–ª: "Telegram: Trigger" | –í–∞—à Telegram ID |
| `YOUR_TELEGRAM_CREDENTIAL_ID` | –í—Å–µ Telegram —É–∑–ª—ã | n8n Credential ID |
| `YOUR_HA_CREDENTIAL_ID` | –í—Å–µ HA —É–∑–ª—ã | n8n Credential ID |

**–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å Telegram User ID:**
```bash
# –ù–∞–ø–∏—à–∏—Ç–µ @userinfobot –≤ Telegram
# –û–Ω –ø—Ä–∏—à–ª–µ—Ç –≤–∞—à ID
```

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ credentials –≤ n8n

#### Home Assistant

1. n8n ‚Üí Credentials ‚Üí Add Credential ‚Üí Home Assistant
2. –í–≤–µ–¥–∏—Ç–µ:
   - **Host:** `http://your-ha-ip:8123`
   - **Access Token:** Long-lived access token –∏–∑ HA

#### Telegram

1. n8n ‚Üí Credentials ‚Üí Add Credential ‚Üí Telegram
2. –í–≤–µ–¥–∏—Ç–µ:
   - **Access Token:** –û—Ç @BotFather

### –®–∞–≥ 5: –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ workflow

```bash
# –í n8n:
Workflow ‚Üí Active: ON
```

---

## üí¨ –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥

### –ì–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

–ü—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É:

- *"–í–∫–ª—é—á–∏ —Å–≤–µ—Ç –Ω–∞ –∫—É—Ö–Ω–µ"*
- *"–°–¥–µ–ª–∞–π —Ç–µ–ø–ª–µ–µ –≤ —Å–ø–∞–ª—å–Ω–µ"*
- *"–ó–∞–ø—É—Å—Ç–∏ —Å—Ü–µ–Ω—É '–í–µ—á–µ—Ä–Ω–∏–π —Ä–µ–∂–∏–º'"*
- *"–ö–∞–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤ –≥–æ—Å—Ç–∏–Ω–æ–π?"*
- *"–í—ã–∫–ª—é—á–∏ –≤—Å–µ —Å–≤–µ—Ç–∏–ª—å–Ω–∏–∫–∏ –≤ –¥–æ–º–µ"*
- *"–£—Å—Ç–∞–Ω–æ–≤–∏ 22 –≥—Ä–∞–¥—É—Å–∞ –≤ –¥–µ—Ç—Å–∫–æ–π"*

### –¢–µ–∫—Å—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

```text
–í–∫–ª—é—á–∏ —Å–≤–µ—Ç –≤ –∫–æ—Ä–∏–¥–æ—Ä–µ
–í—ã–∫–ª—é—á–∏ –∫—É—Ö–Ω—é
–£—Å—Ç–∞–Ω–æ–≤–∏ —è—Ä–∫–æ—Å—Ç—å 50% –≤ —Å–ø–∞–ª—å–Ω–µ
–°–¥–µ–ª–∞–π –≤ –∑–∞–ª–µ 23 –≥—Ä–∞–¥—É—Å–∞
–ó–∞–ø—É—Å—Ç–∏ —Å—Ü–µ–Ω—É "–ö–∏–Ω–æ"
```

#### –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

```text
–ö–∞–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –Ω–∞ —É–ª–∏—Ü–µ?
–í–∫–ª—é—á–µ–Ω –ª–∏ —Å–≤–µ—Ç –≤ –≥–∞—Ä–∞–∂–µ?
–ü–æ–∫–∞–∂–∏ —Å—Ç–∞—Ç—É—Å –∫–ª–∏–º–∞—Ç–∞ –≤ —Å–ø–∞–ª—å–Ω–µ
```

#### –°–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```text
/lights - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–≤–µ—Ç–∏–ª—å–Ω–∏–∫–æ–≤
/scenes - –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ü–µ–Ω—ã
/status - –æ–±—â–∏–π —Å—Ç–∞—Ç—É—Å –¥–æ–º–∞
/help - —Å–ø—Ä–∞–≤–∫–∞
/clear - –æ—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞
```

---

## üîß Home Assistant Tools

Workflow —Ä–µ–∞–ª–∏–∑—É–µ—Ç 8 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è HA:

### 1. turn_on_light
–í–∫–ª—é—á–∞–µ—Ç —Å–≤–µ—Ç —Å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π —è—Ä–∫–æ—Å—Ç—å—é

```javascript
{
  "entity_id": "light.kitchen",
  "brightness": 200  // 0-255, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
}
```

### 2. turn_off_light
–í—ã–∫–ª—é—á–∞–µ—Ç —Å–≤–µ—Ç

```javascript
{
  "entity_id": "light.kitchen"
}
```

### 3. set_temperature
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ü–µ–ª–µ–≤—É—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É

```javascript
{
  "entity_id": "climate.bedroom",
  "temperature": 22
}
```

### 4. set_climate_mode
–ú–µ–Ω—è–µ—Ç —Ä–µ–∂–∏–º –∫–ª–∏–º–∞—Ç–∞

```javascript
{
  "entity_id": "climate.bedroom",
  "hvac_mode": "heat"  // heat, cool, heat_cool, off, auto
}
```

### 5. activate_scene
–ó–∞–ø—É—Å–∫–∞–µ—Ç —Å—Ü–µ–Ω—É

```javascript
{
  "entity_id": "scene.evening"
}
```

### 6. get_sensor_state
–ü–æ–ª—É—á–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∞—Ç—á–∏–∫–∞

```javascript
{
  "entity_id": "sensor.temperature_outdoor"
}
```

### 7. list_lights
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–≤–µ—Ç–∏–ª—å–Ω–∏–∫–æ–≤

```javascript
{}  // –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
```

### 8. list_scenes
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—Ü–µ–Ω

```javascript
{}  // –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
```

---

## üß† –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø–∞–º—è—Ç—å

–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–æ–º–Ω–∏—Ç **–ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π** –≤ –¥–∏–∞–ª–æ–≥–µ.

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

```text
–í—ã: –í–∫–ª—é—á–∏ —Å–≤–µ—Ç –Ω–∞ –∫—É—Ö–Ω–µ
–ë–æ—Ç: –°–≤–µ—Ç –Ω–∞ –∫—É—Ö–Ω–µ –≤–∫–ª—é—á–µ–Ω ‚úÖ

–í—ã: –ê —Å–¥–µ–ª–∞–π —è—Ä—á–µ
–ë–æ—Ç: –£—Å—Ç–∞–Ω–æ–≤–∏–ª —è—Ä–∫–æ—Å—Ç—å 100% –Ω–∞ –∫—É—Ö–Ω–µ

–í—ã: –¢–µ–ø–µ—Ä—å –≤—ã–∫–ª—é—á–∏
–ë–æ—Ç: –°–≤–µ—Ç –Ω–∞ –∫—É—Ö–Ω–µ –≤—ã–∫–ª—é—á–µ–Ω
```

### –û—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

–ï—Å–ª–∏ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç "–ø—É—Ç–∞–µ—Ç—Å—è" –∏–ª–∏ –ø–æ–º–Ω–∏—Ç —Å—Ç–∞—Ä—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç:

```bash
/clear
```

---

## üÜò Troubleshooting

### –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞—é—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á Yandex Cloud
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Folder ID –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–≤–æ—Ç—É SpeechKit (180 –º–∏–Ω/–º–µ—Å—è—Ü –ø–æ—Å–ª–µ –≥—Ä–∞–Ω—Ç–∞)

```bash
# –¢–µ—Å—Ç SpeechKit:
curl -X POST \
  https://stt.api.cloud.yandex.net/speech/v1/stt:recognize \
  -H "Authorization: Api-Key YOUR_KEY" \
  -F "audio=@test.ogg" \
  -F "lang=ru-RU" \
  -F "folderId=YOUR_FOLDER_ID"
```

### YandexGPT –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–∞–π–º–∞—É—Ç –∏–ª–∏ –æ—à–∏–±–∫–∞ 401/403

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ modelUri –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π: `gpt://FOLDER_ID/yandexgpt-lite`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–≤–æ—Ç—É (10,000 —Ç–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å –¥–ª—è lite)

**GigaChat –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç –µ—Å–ª–∏ YandexGPT –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!

### –ö–æ–º–∞–Ω–¥—ã –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ HA

**–ü—Ä–æ–±–ª–µ–º–∞:** –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç –æ—Ç–≤–µ—á–∞–µ—Ç, –Ω–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–µ —Ä–µ–∞–≥–∏—Ä—É—é—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ credential Home Assistant –≤ n8n
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `entity_id` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ HA ‚Üí Developer Tools ‚Üí States)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —É —Ç–æ–∫–µ–Ω–∞ –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

```yaml
# –í HA —Å–æ–∑–¥–∞–π—Ç–µ long-lived token:
# Profile ‚Üí Long-Lived Access Tokens ‚Üí Create Token
```

### –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã

**–ü—Ä–æ–±–ª–µ–º–∞:** –û—Ç–≤–µ—á–∞–µ—Ç –Ω–µ–≤–ø–æ–ø–∞–¥ –∏–ª–∏ –ø—Ä–æ—Å–∏—Ç —É—Ç–æ—á–Ω–∏—Ç—å

**–†–µ—à–µ–Ω–∏–µ:**
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è: "—Å–≤–µ—Ç –Ω–∞ –∫—É—Ö–Ω–µ", –∞ –Ω–µ "–∫—É—Ö–Ω—è"
2. –û—á–∏—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç: `/clear`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤ HA —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –≤–∞—à–∏–º –∫–æ–º–∞–Ω–¥–∞–º

**–°–æ–≤–µ—Ç:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ friendly names –≤ HA:

```yaml
# configuration.yaml
homeassistant:
  customize:
    light.kitchen_main:
      friendly_name: "–°–≤–µ—Ç –Ω–∞ –∫—É—Ö–Ω–µ"
```

---

## üîÑ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

1. –û—Ç–∫—Ä–æ–π—Ç–µ —É–∑–µ–ª **"Prepare: HA Tools"**
2. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é –≤ –º–∞—Å—Å–∏–≤ `tools`:

```javascript
{
  type: "function",
  function: {
    name: "open_cover",
    description: "–û—Ç–∫—Ä—ã—Ç—å —à—Ç–æ—Ä—É –∏–ª–∏ –∂–∞–ª—é–∑–∏",
    parameters: {
      type: "object",
      properties: {
        entity_id: {
          type: "string",
          description: "ID —à—Ç–æ—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: cover.bedroom)"
        }
      },
      required: ["entity_id"]
    }
  }
}
```

3. –î–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ **"Switch: Function Type"**
4. –°–æ–∑–¥–∞–π—Ç–µ —É–∑–µ–ª **"HA: Open Cover"**

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

–í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è:
- üéµ **Sonos/Music** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º—É–∑—ã–∫–æ–π
- üì∫ **Media Players** - –¢–í –∏ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è
- üîê **Locks** - –∑–∞–º–∫–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- üìπ **Cameras** - –ø—Ä–æ—Å–º–æ—Ç—Ä –∫–∞–º–µ—Ä
- ‚è∞ **Timers** - —Ç–∞–π–º–µ—Ä—ã –∏ –±—É–¥–∏–ª—å–Ω–∏–∫–∏

---

## üó∫Ô∏è Roadmap

### –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

- [ ] **Google Assistant** –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
  - –ì–æ–ª–æ—Å–æ–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Google –∫–æ–ª–æ–Ω–∫—É
  - Intent recognition
  - Entity mapping

- [ ] **OLLAMA** –ø–æ–¥–¥–µ—Ä–∂–∫–∞
  - –õ–æ–∫–∞–ª—å–Ω—ã–π LLM (llama3, mistral)
  - –õ–æ–∫–∞–ª—å–Ω–∞—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è (Whisper)
  - –ü–æ–ª–Ω–∞—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –æ–±–ª–∞–∫–∞

- [ ] **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**
  - –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å (EN, DE, FR)
  - –ì–æ–ª–æ—Å–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã (TTS)
  - –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è (—Ä–∞–∑–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
  - –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –¥–µ–π—Å—Ç–≤–∏–π

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –ø–ª–∞–Ω—ã

- [ ] **Yandex Station** –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–ê–ª–∏—Å–∞)
- [ ] **Web UI** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- [ ] **iOS/Android** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- [ ] **Offline —Ä–µ–∂–∏–º** (–ø–æ–ª–Ω–æ—Å—Ç—å—é –ª–æ–∫–∞–ª—å–Ω–æ)

---

## üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –∫–≤–æ—Ç–∞ (–ø–µ—Ä–≤—ã–µ 2 –º–µ—Å—è—Ü–∞)

| –°–µ—Ä–≤–∏—Å | –õ–∏–º–∏—Ç | –°—Ç–æ–∏–º–æ—Å—Ç—å |
|--------|-------|-----------|
| **YandexGPT Lite** | –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ | ‚úÖ $0 |
| **SpeechKit STT** | 3,000 –º–∏–Ω—É—Ç | ‚úÖ $0 |
| **GigaChat** | –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ | ‚úÖ $0 |
| **Telegram** | –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ | ‚úÖ $0 |

### –ü–æ—Å–ª–µ –≥—Ä–∞–Ω—Ç–∞ (—Å 3-–≥–æ –º–µ—Å—è—Ü–∞)

| –°–µ—Ä–≤–∏—Å | –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ª–∏–º–∏—Ç | –¶–µ–Ω–∞ —Å–≤–µ—Ä—Ö –ª–∏–º–∏—Ç–∞ |
|--------|------------------|-------------------|
| **YandexGPT Lite** | 10,000 —Ç–æ–∫–µ–Ω–æ–≤/–¥–µ–Ω—å | ~‚ÇΩ0.15/1K —Ç–æ–∫–µ–Ω–æ–≤ |
| **SpeechKit STT** | 180 –º–∏–Ω/–º–µ—Å—è—Ü | ‚ÇΩ0.70/–º–∏–Ω |
| **GigaChat** | –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ | ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ |

**–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç:**
- **100 –∫–æ–º–∞–Ω–¥/–¥–µ–Ω—å** ‚âà 50,000 —Ç–æ–∫–µ–Ω–æ–≤/–º–µ—Å—è—Ü ‚âà **‚ÇΩ200/–º–µ—Å**
- **10 –≥–æ–ª–æ—Å–æ–≤—ã—Ö/–¥–µ–Ω—å** ‚âà 50 –º–∏–Ω—É—Ç/–º–µ—Å—è—Ü ‚âà **–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –∫–≤–æ—Ç—ã**

**–ò—Ç–æ–≥–æ:** ~‚ÇΩ200/–º–µ—Å –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
- [Yandex Cloud Setup](./YANDEX-CLOUD-SETUP.md)
- [YandexGPT Docs](https://cloud.yandex.ru/docs/yandexgpt/)
- [SpeechKit Docs](https://cloud.yandex.ru/docs/speechkit/)
- [GigaChat Docs](https://developers.sber.ru/docs/ru/gigachat/api/overview)

### n8n
- [n8n Home Assistant](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.homeassistant/)
- [n8n Langchain](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain/)
- [Function Calling](https://docs.n8n.io/advanced-ai/examples/function-calling/)

### Home Assistant
- [REST API](https://developers.home-assistant.io/docs/api/rest/)
- [Services](https://www.home-assistant.io/docs/scripts/service-calls/)
- [Long-lived tokens](https://www.home-assistant.io/docs/authentication/)

---

## üìù Changelog

### v1.0 (2025-10-09)
- ‚úÖ –ü–µ—Ä–≤—ã–π —Ä–µ–ª–∏–∑
- ‚úÖ YandexGPT + GigaChat fallback
- ‚úÖ Yandex SpeechKit —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è
- ‚úÖ 8 Home Assistant tools
- ‚úÖ BufferWindowMemory –∫–æ–Ω—Ç–µ–∫—Å—Ç
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ

–ï—Å–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã - —Å–æ–∑–¥–∞–π—Ç–µ Issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.
