# ๐ ะัััััะน ััะฐัั n8n ะดะปั ะฒะฐัะตะน ะธะฝััะฐััััะบัััั

ะะฐัััะพะนะบะฐ n8n ะดะปั ัะฐะฑะพัั ั ะฒะฐัะธะผ Home Assistant (ัะถะต ัะฐะทะฒะตัะฝัั ะฝะฐ Proxmox).

---

## ๐๏ธ ะะฐัะฐ ัะตะบััะฐั ะธะฝััะฐััััะบัััะฐ

```text
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  ะะพะบะฐะปัะฝะฐั ัะตัั 192.168.1.0/24              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโ        โโโโโโโโโโโโโโโโโโโโ          โ
โ  โ  Home Assistant  โโโโโโโโโบโ     n8n          โ          โ
โ  โ  192.168.1.20    โ        โ  (Proxmox VM)    โ          โ
โ  โ  :8123           โ        โ  192.168.1.???   โ          โ
โ  โโโโโโโโโโโโโโโโโโโโ        โโโโโโโโโโโโโโโโโโโโ          โ
โ         โ                            โ                      โ
โ         โ MCP addon                  โ                      โ
โ         โ (ะฒะฝัััะธ HA)               โ                      โ
โ         โ                            โ                      โ
โ  โโโโโโโโโโโโโโโโโโโโ                โ                      โ
โ  โ   Cursor IDE     โ                โ                      โ
โ  โ  (ะฒะฐั ะะ/WSL)    โ                โ                      โ
โ  โ  + mcp-proxy     โโโโโโโโโโโโโโโโโโ                      โ
โ  โโโโโโโโโโโโโโโโโโโโ                                       โ
โ                                                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะกัะฐััั:**

- โ Home Assistant ัะฐะฑะพัะฐะตั (192.168.1.20)
- โ MCP addon ัััะฐะฝะพะฒะปะตะฝ ะฒ HASSio
- โ mcp-proxy ะฝะฐัััะพะตะฝ ะฒ Cursor
- โ n8n ัะฐะทะฒะตัะฝัั ะฝะฐ Proxmox
- โณ n8n ะฝะต ะฝะฐัััะพะตะฝ (ะฝะตั workflows)

---

## ๐ฏ ะะปะฐะฝ ะฟะตัะฒะธัะฝะพะน ะฝะฐัััะพะนะบะธ (20 ะผะธะฝัั)

### ะจะฐะณ 1: ะฃะทะฝะฐัั IP ะฐะดัะตั n8n (2 ะผะธะฝััั)

```bash
# ะะฐ Proxmox ะธะปะธ ะธะท HASSio
ping n8n.local  # ะัะปะธ ะตััั mDNS

# ะะปะธ ะฟัะพะฒะตัะธัั ะฒ Proxmox
# Containers โ <ะฒะฐั n8n> โ Network โ IP
```

ะัะตะดะฟะพะปะพะถะธะผ IP: **192.168.1.50**

---

### ะจะฐะณ 2: ะะพะฑะฐะฒะธัั ะฒ config.yml (3 ะผะธะฝััั)

ะัะบัะพะนัะต `~/HASSio/config.yml` ะธ ะดะพะฑะฐะฒััะต ัะตะบัะธั:

```yaml
# n8n Integration
n8n:
  enabled: true
  url_local: "http://192.168.1.50:5678"
  # ะัะปะธ n8n ะดะพัััะฟะตะฝ ะธะทะฒะฝะต:
  url_external: ""  # ะััะฐะฒััะต ะฟััััะผ ะตัะปะธ ะฝะตั

  # API Key (ะฟะพะปััะธะผ ะฝะฐ ัะฐะณะต 3)
  api_key: ""

  # Webhook base URL
  webhooks:
    base_url: "http://192.168.1.50:5678/webhook"
```

---

### ะจะฐะณ 3: ะะฐัััะพะธัั n8n (5 ะผะธะฝัั)

#### 3.1. ะัะบัััั n8n

```bash
# ะ ะฑัะฐัะทะตัะต
http://192.168.1.50:5678
```

#### 3.2. ะกะพะทะดะฐัั API Key (ะตัะปะธ ะตัะต ะฝะตั)

1. ะ n8n: **Settings** (ะปะตะฒะพะต ะผะตะฝั)
2. **API** โ **Create API Key**
3. ะะฐะทะฒะฐะฝะธะต: `HASSio Integration`
4. **Create**
5. ะกะบะพะฟะธััะนัะต ะบะปัั

#### 3.3. ะะฑะฝะพะฒะธัั config.yml

```yaml
n8n:
  api_key: "n8n_api_xxxxxxxxxxxxx"  # ะะฐั ะบะปัั
```

---

### ะจะฐะณ 4: ะกะพะทะดะฐัั Long-Lived Token ะฒ HA (3 ะผะธะฝััั)

1. ะัะบัะพะนัะต Home Assistant (http://192.168.1.20:8123)
2. ะัะพัะธะปั (ะปะตะฒัะน ะฝะธะถะฝะธะน ัะณะพะป)
3. ะัะพะบัััะธัะต ะดะพ **Long-Lived Access Tokens**
4. **CREATE TOKEN**
5. ะะฐะทะฒะฐะฝะธะต: `n8n Integration`
6. ะกะบะพะฟะธััะนัะต ัะพะบะตะฝ (ะฑะพะปััะต ะฝะต ะฟะพะบะฐะถะตััั!)

ะกะพััะฐะฝะธัะต ัะพะบะตะฝ - ะฟะพะฝะฐะดะพะฑะธััั ะฒ ะบะฐะถะดะพะผ workflow!

---

### ะจะฐะณ 5: ะกะพะทะดะฐัั Credential ะฒ n8n (5 ะผะธะฝัั)

1. ะ n8n: **Credentials** (ะปะตะฒะพะต ะผะตะฝั)
2. **Add Credential**
3. ะะพะธัะบ: `Home Assistant`
4. ะัะฑะตัะธัะต **Home Assistant API**
5. ะะฐะฟะพะปะฝะธัะต:
   - **Name**: `Home Assistant Local`
   - **Host**: `http://192.168.1.20:8123`
   - **Access Token**: ัะพะบะตะฝ ะธะท ัะฐะณะฐ 4
6. **Save**

---

### ะจะฐะณ 6: ะขะตััะพะฒัะน workflow (7 ะผะธะฝัั)

ะกะพะทะดะฐะนัะต ะฟะตัะฒัะน workflow ะดะปั ะฟัะพะฒะตัะบะธ:

#### 6.1. ะกะพะทะดะฐัั workflow

1. **Workflows** โ **Add workflow**
2. ะะฐะทะฒะฐะฝะธะต: `Test HA Connection`

#### 6.2. ะะพะฑะฐะฒะธัั ะฝะพะดั

**ะะพะดะฐ 1: Manual Trigger**

- ะขะธะฟ: **Manual Trigger**
- ะัะพััะพ ะดะพะฑะฐะฒััะต (ะดะปั ัััะฝะพะณะพ ะทะฐะฟััะบะฐ)

**ะะพะดะฐ 2: Get HA State**

- ะขะธะฟ: **Home Assistant**
- Credential: `Home Assistant Local`
- Operation: **Get State**
- Entity ID: `sun.sun` (ะฒัะตะณะดะฐ ะตััั ะฒ HA)

**ะะพะดะฐ 3: Show Result**

- ะขะธะฟ: **Code**
- Language: JavaScript
- Code:

```javascript
const state = $input.item.json.state;
const friendly = $input.item.json.attributes.friendly_name;

return {
  json: {
    message: `โ ะะพะดะบะปััะตะฝะธะต ัะฐะฑะพัะฐะตั! ${friendly}: ${state}`,
    raw: $input.item.json
  }
};
```

#### 6.3. ะัะพัะตััะธัะพะฒะฐัั

1. **Save** workflow
2. **Execute Workflow**
3. ะะพะปะถะฝั ัะฒะธะดะตัั: `โ ะะพะดะบะปััะตะฝะธะต ัะฐะฑะพัะฐะตั! Sun: above_horizon`

---

## ๐ฏ ะะตัะฒัะต 3 ะฟะพะปะตะทะฝัั workflow

ะะพัะปะต ััะฟะตัะฝะพะณะพ ัะตััะฐ, ัะพะทะดะฐะนัะต ััะธ workflows:

### Workflow 1: ะัะบะฐะฟ ะฒ ะพะฑะปะฐะบะพ (ะฟัะธะพัะธัะตั ๐ฅ)

**ะะฐะทะฝะฐัะตะฝะธะต:**
ะะฒัะพะผะฐัะธัะตัะบะธ ะทะฐะณััะถะฐัั ะฑัะบะฐะฟั HA ะฒ ะพะฑะปะฐัะฝะพะต ััะฐะฝะธะปะธัะต.

**ะะพะดั:**

1. **Webhook** (ััะธะณะณะตั)
   - Webhook ID: `ha-backup-created`
   - Path: `/webhook/ha-backup-created`

2. **SSH** - ะกะบะฐัะฐัั ะฑัะบะฐะฟ
   - Host: `192.168.1.20`
   - Command: `ls -t /backup/*.tar | head -1`
   - Download ะฟะพัะปะตะดะฝะธะน ัะฐะนะป

3. **Yandex Disk / Dropbox** - ะะฐะณััะทะธัั
   - Path: `/HomeAssistant/Backups/{{ $now.format('YYYY-MM') }}/`
   - Filename: `backup-{{ $now.format('YYYY-MM-DD-HH-mm') }}.tar`

4. **Telegram** - ะฃะฒะตะดะพะผะปะตะฝะธะต
   - Message: `โ ะัะบะฐะฟ ะทะฐะณััะถะตะฝ ะฒ ะพะฑะปะฐะบะพ`

**ะะฐัััะพะนะบะฐ ะฒ HA:**

```yaml
# automations.yaml
automation:
  - alias: "Backup to n8n"
    trigger:
      - platform: event
        event_type: folder_watcher
        event_data:
          event_type: created
          path: /backup
    action:
      - service: rest_command.n8n_backup_webhook
```

```yaml
# configuration.yaml
rest_command:
  n8n_backup_webhook:
    url: "http://192.168.1.50:5678/webhook/ha-backup-created"
    method: POST
    content_type: "application/json"
    payload: >
      {
        "timestamp": "{{ now().isoformat() }}",
        "trigger": "backup_created"
      }
```

---

### Workflow 2: Telegram ะฑะพั ััะฐัััะฐ (ะฟัะธะพัะธัะตั ๐ฅ)

**ะะฐะทะฝะฐัะตะฝะธะต:**
ะะพะผะฐะฝะดะฐ `/status` โ ะฟะพะปะฝัะน ััะฐััั ัะผะฝะพะณะพ ะดะพะผะฐ.

**ะะพะดั:**

1. **Telegram Trigger**
   - Command: `/status`

2. **Home Assistant** - Get Multiple States
   - Entities:
     - `sensor.outdoor_temperature`
     - `climate.living_room` (ะธ ะดััะณะธะต 14 ะทะพะฝ)
     - `binary_sensor.*_motion` (ะบะฐะผะตัั)
     - `sensor.total_power`

3. **Code** - ะคะพัะผะฐัะธัะพะฒะฐะฝะธะต

```javascript
const outdoor = $('Get States').item.json[0].state;
const climates = $('Get States').item.json.filter(e => e.entity_id.startsWith('climate.'));
const power = $('Get States').item.json.find(e => e.entity_id === 'sensor.total_power').state;

// ะกัะตะดะฝัั ัะตะผะฟะตัะฐัััะฐ ะฟะพ ะทะพะฝะฐะผ
const avgTemp = climates.reduce((sum, c) =>
  sum + parseFloat(c.attributes.current_temperature), 0) / climates.length;

const message = `๐ ะกัะฐััั ัะผะฝะพะณะพ ะดะพะผะฐ

๐ก๏ธ ะัะพะฟะปะตะฝะธะต:
  ะะฐ ัะปะธัะต: ${outdoor}ยฐC
  ะะพะผะฐ (ััะตะดะฝัั): ${avgTemp.toFixed(1)}ยฐC
  ะะพะฝั: ${climates.length}

โก ะญะฝะตัะณะธั:
  ะขะตะบััะตะต ะฟะพััะตะฑะปะตะฝะธะต: ${power} ะั

๐น ะะตะทะพะฟะฐัะฝะพััั:
  ะะฐะผะตัั: ะัะต ะพะฝะปะฐะนะฝ โ

โฐ ${new Date().toLocaleString('ru-RU')}`;

return { json: { message } };
```

4. **Telegram** - ะัะฟัะฐะฒะธัั ะพัะฒะตั

---

### Workflow 3: ะะพะณะพะดะพะทะฐะฒะธัะธะผะฐั ะบัะธะฒะฐั (ะฟัะธะพัะธัะตั ๐ฅ)

**ะะฐะทะฝะฐัะตะฝะธะต:**
ะะฒัะพะผะฐัะธัะตัะบะฐั ะบะพััะตะบัะธัะพะฒะบะฐ ัะตะผะฟะตัะฐัััั ะฒ 15 ะทะพะฝะฐั ะฟะพ ะฟะพะณะพะดะต.

**ะะพะดั:**

1. **Cron Trigger**
   - Expression: `*/30 * * * *` (ะบะฐะถะดัะต 30 ะผะธะฝัั)

2. **HTTP Request** - ะัะพะณะฝะพะท ะฟะพะณะพะดั
   - URL: `https://api.openweathermap.org/data/2.5/weather?q=YourCity&appid=YOUR_KEY`
   - Method: GET

3. **Code** - ะะฐััะตั ัะตะผะฟะตัะฐััั

```javascript
const outdoor = $json.main.temp - 273.15; // Kelvin โ Celsius
const wind = $json.wind.speed;

// ะะฐะทะพะฒะฐั ะฟะพะณะพะดะพะทะฐะฒะธัะธะผะฐั ะบัะธะฒะฐั
let target = 25 - (outdoor * 0.5);

// ะะพััะตะบัะธัะพะฒะบะฐ ะฝะฐ ะฒะตัะตั (ัะตะฟะปะพะฟะพัะตัะธ)
if (wind > 5) {
  target += Math.min(wind / 10, 2);
}

// ะะณัะฐะฝะธัะตะฝะธั
target = Math.max(18, Math.min(25, target));

// ะะพะฝั ั ัะฐะทะฝัะผะธ ัะตะผะฟะตัะฐัััะฐะผะธ
const zones = [
  { id: 'living_room', offset: 0 },      // ะะพััะธะฝะฐั: ะฑะฐะทะพะฒะฐั
  { id: 'bedroom', offset: -2 },         // ะกะฟะฐะปัะฝั: ะฟัะพัะปะฐะดะฝะตะต
  { id: 'kitchen', offset: -1 },         // ะััะฝั: ัััั ะฟัะพัะปะฐะดะฝะตะต
  { id: 'bathroom', offset: +2 },        // ะะฐะฝะฝะฐั: ัะตะฟะปะตะต
  // ... ะดะพะฑะฐะฒััะต ะฒัะต 15 ะทะพะฝ
];

return zones.map(zone => ({
  json: {
    entity_id: `climate.${zone.id}`,
    temperature: Math.round(target + zone.offset)
  }
}));
```

4. **Loop** - ะะปั ะบะฐะถะดะพะน ะทะพะฝั
   - Items: Output ะธะท ะฟัะตะดัะดััะตะน ะฝะพะดั
   - Batch Size: 1

5. **Home Assistant** - Set Temperature
   - Operation: **Call Service**
   - Domain: `climate`
   - Service: `set_temperature`
   - Entity ID: `{{ $json.entity_id }}`
   - Service Data:

```json
{
  "temperature": "{{ $json.temperature }}"
}
```

6. **Telegram** - ะฃะฒะตะดะพะผะปะตะฝะธะต (ะพะฟัะธะพะฝะฐะปัะฝะพ)
   - ะขะพะปัะบะพ ะตัะปะธ ัะตะผะฟะตัะฐัััะฐ ะธะทะผะตะฝะธะปะฐัั > 2ยฐC

**ะญะบะพะฝะพะผะธั:** 20-30% ะฝะฐ ะพัะพะฟะปะตะฝะธะธ ะฟัะธ ะฟัะฐะฒะธะปัะฝะพะน ะฝะฐัััะพะนะบะต ะบัะธะฒะพะน!

---

## ๐ ะะฑะฝะพะฒะปะตะฝะธะต ะฟัะพะตะบัะฐ HASSio_Cursor

### ะะพะฑะฐะฒะธัั ะธะฝัะพัะผะฐัะธั ะพ ะฒะฐัะตะน ะธะฝััะฐััััะบัััะต

ะะฑะฝะพะฒะธัะต `config.yml`:

```yaml
# Home Assistant Server
server:
  url: "https://your-ha-server.com"
  hostname: "your-ha-server.com"
  local_ip: "192.168.1.20"

# n8n Integration
n8n:
  enabled: true
  # Proxmox VM ะฒ ะปะพะบะฐะปัะฝะพะน ัะตัะธ
  url_local: "http://192.168.1.50:5678"  # ะะฐะผะตะฝะธัะต ะฝะฐ ัะตะฐะปัะฝัะน IP
  url_external: ""  # ะัะปะธ ะฝะตั ะฒะฝะตัะฝะตะณะพ ะดะพัััะฟะฐ
  api_key: ""  # ะะพะปััะธัะต ะฒ n8n: Settings โ API
  webhooks:
    base_url: "http://192.168.1.50:5678/webhook"

# MCP Settings (ัะถะต ะฝะฐัััะพะตะฝะพ)
mcp:
  # MCP addon ัััะฐะฝะพะฒะปะตะฝ ะฒ HASSio
  # mcp-proxy ัััะฐะฝะพะฒะปะตะฝ ะฒ ัะธััะตะผะต
  # ะะพะฝัะธะณััะฐัะธั ะฒ .cursor/mcp.json
  use_local: false
  token: "your_mcp_token_here"
  endpoint_global: "https://your-ha-server.com/mcp_server/sse"
  endpoint_local: "http://192.168.1.20:8123/mcp_server/sse"
```

---

## ๐ง ะกะบัะธะฟั ะฟัะพะฒะตัะบะธ n8n

ะกะพะทะดะฐะนัะต ัะบัะธะฟั ะดะปั ะฑััััะพะน ะฟัะพะฒะตัะบะธ:

```bash
#!/bin/bash
# scripts/check_n8n.sh
# ะัะพะฒะตัะบะฐ ะฟะพะดะบะปััะตะฝะธั ะบ n8n

source "$(dirname "$0")/lib_config.sh"

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ              ๐ ะะะะะะะะ n8n ะะะขะะะะะฆะะ ๐                       โ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# ะัะตะดะฟะพะปะฐะณะฐะตะผ ััะพ ะฒ config.yml ะตััั n8n ัะตะบัะธั
N8N_URL="${N8N_URL_LOCAL:-http://192.168.1.50:5678}"

echo "๐ n8n URL: $N8N_URL"
echo ""

# ะัะพะฒะตัะบะฐ 1: ะะพัััะฟะฝะพััั
echo "๐ ะัะพะฒะตัะบะฐ ะดะพัััะฟะฝะพััะธ..."
if curl -s -f "$N8N_URL/healthz" > /dev/null 2>&1; then
    echo "โ n8n ะดะพัััะฟะตะฝ"
else
    echo "โ n8n ะฝะตะดะพัััะฟะตะฝ (ะฟัะพะฒะตัััะต IP ะธ firewall)"
    exit 1
fi

# ะัะพะฒะตัะบะฐ 2: API (ะตัะปะธ ะตััั ะบะปัั)
if [ -n "${N8N_API_KEY:-}" ]; then
    echo ""
    echo "๐ ะัะพะฒะตัะบะฐ API..."
    response=$(curl -s -H "X-N8N-API-KEY: $N8N_API_KEY" \
        "$N8N_URL/api/v1/workflows" 2>/dev/null)

    if echo "$response" | jq -e '.data' > /dev/null 2>&1; then
        workflow_count=$(echo "$response" | jq -r '.data | length')
        echo "โ API ัะฐะฑะพัะฐะตั"
        echo "๐ Workflows: $workflow_count"
    else
        echo "โ๏ธ  API ะบะปัั ะฝะต ะฝะฐัััะพะตะฝ ะธะปะธ ะฝะตะฒะตัะฝัะน"
    fi
else
    echo ""
    echo "โ๏ธ  API ะบะปัั ะฝะต ะฝะฐัััะพะตะฝ ะฒ config.yml"
    echo "   ะะพะปััะธัะต ะฒ n8n: Settings โ API โ Create API Key"
fi

echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ              โ ะะะะะะะะ ะะะะะะจะะะ                               โ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# ะะพะบะฐะทะฐัั ัะปะตะดัััะธะต ัะฐะณะธ
if [ -z "${N8N_API_KEY:-}" ]; then
    echo "๐ ะกะปะตะดัััะธะต ัะฐะณะธ:"
    echo "   1. ะัะบัะพะนัะต n8n: $N8N_URL"
    echo "   2. Settings โ API โ Create API Key"
    echo "   3. ะะพะฑะฐะฒััะต ะบะปัั ะฒ ~/HASSio/config.yml"
    echo "   4. ะกะพะทะดะฐะนัะต credential 'Home Assistant Local'"
    echo "   5. ะะผะฟะพััะธััะนัะต ะฟะตัะฒัะต workflows"
fi
```

**ะัะฟะพะปัะทะพะฒะฐะฝะธะต:**

```bash
chmod +x scripts/check_n8n.sh
./scripts/check_n8n.sh
```

---

## ๐ฌ ะะตัะฒัะต workflows ะดะปั ะธะผะฟะพััะฐ

### ะะพัะพะฒัะต JSON ัะฐะนะปั (TODO)

ะกะพะทะดะฐะนัะต ะฟะฐะฟะบั:

```bash
mkdir -p scripts/templates/n8n
```

ะัะดัั ะณะพัะพะฒัะต workflows:

- `test_ha_connection.json` - ัะตัั ะฟะพะดะบะปััะตะฝะธั
- `backup_to_cloud.json` - ะฑัะบะฐะฟั ะฒ ะพะฑะปะฐะบะพ
- `telegram_status_bot.json` - Telegram ะฑะพั
- `heating_weather_curve.json` - ะฟะพะณะพะดะฝะฐั ะบัะธะฒะฐั
- `smart_camera_alerts.json` - ัะผะฝัะต ะฐะปะตััั

### ะะผะฟะพัั ะฒ n8n

1. ะ n8n: **Workflows** โ **Import from File**
2. ะัะฑะตัะธัะต JSON ัะฐะนะป
3. **Configure credentials:**
   - Home Assistant: ะฒัะฑะตัะธัะต ัะพะทะดะฐะฝะฝัะน credential
   - Telegram (ะตัะปะธ ะฝัะถะฝะพ): ะดะพะฑะฐะฒััะต bot token
4. **ะะฐะผะตะฝะธัะต ะฟะตัะตะผะตะฝะฝัะต:**
   - IP ะฐะดัะตัะฐ (ะตัะปะธ ะพัะปะธัะฐัััั)
   - Entity IDs (ะฟะพะด ะฒะฐัั ะบะพะฝัะธะณััะฐัะธั)
5. **Save** โ **Activate**

---

## ๐ ะะตะบะพะผะตะฝะดัะตะผะฐั ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั

### ะะตะดะตะปั 1: ะะฐะทะพะฒะฐั ะฝะฐัััะพะนะบะฐ

**ะะตะฝั 1:**

- โ ะฃะทะฝะฐัั IP n8n
- โ ะะฑะฝะพะฒะธัั config.yml
- โ ะกะพะทะดะฐัั ัะพะบะตะฝั (HA + n8n)
- โ ะะฐัััะพะธัั credential ะฒ n8n
- โ ะขะตััะพะฒัะน workflow

**ะะตะฝั 2:**

- โ Workflow: ะัะบะฐะฟั ะฒ ะพะฑะปะฐะบะพ
- โ ะัะพัะตััะธัะพะฒะฐัั
- โ ะะฐัััะพะธัั ะฐะฒัะพะผะฐัะธัะตัะบะธะน ััะธะณะณะตั

**ะะตะฝั 3:**

- โ Workflow: Telegram ะฑะพั ััะฐัััะฐ
- โ ะะพะฑะฐะฒะธัั ะบะพะผะฐะฝะดั /status, /temp

### ะะตะดะตะปั 2: ะะฒัะพะผะฐัะธะทะฐัะธะธ

**ะะตะฝั 1:**

- โ Workflow: ะะพะณะพะดะพะทะฐะฒะธัะธะผะฐั ะบัะธะฒะฐั
- โ ะะฐัััะพะธัั ะฟะพะด 15 ะทะพะฝ
- โ ะะพะฝะธัะพัะธะฝะณ ัะบะพะฝะพะผะธะธ

**ะะตะฝั 2:**

- โ Workflow: ะฃะผะฝัะต ะฐะปะตััั ะบะฐะผะตั
- โ ะคะธะปัััะฐัะธั ะปะพะถะฝัั ััะฐะฑะฐััะฒะฐะฝะธะน

**ะะตะฝั 3:**

- โ Workflow: ะะถะตะฝะตะดะตะปัะฝัะต ะพััะตัั
- โ ะะฝะฐะปะธัะธะบะฐ ัะฝะตัะณะพะฟะพััะตะฑะปะตะฝะธั

### ะะตะดะตะปั 3: AI ะฐะณะตะฝัั

**ะะตะฝั 1:**

- โ ะะฐัััะพะธัั OpenAI API / Ollama
- โ Workflow: AI ะััะธััะตะฝั
- โ ะขะตััะธัะพะฒะฐะฝะธะต

**ะะตะฝั 2:**

- โ Workflow: AI Vision ะดะปั ะบะฐะผะตั
- โ ะะฝะฐะปะธะท snapshots

**ะะตะฝั 3:**

- โ Workflow: RAG ะดะปั ะดะพะบัะผะตะฝัะฐัะธะธ
- โ ะะพะฟัะพัั ะพ ะบะพะฝัะธะณััะฐัะธะธ

---

## ๐ฏ ะะฝัะตะณัะฐัะธั ะฒ ะผะตะฝั ./ha

ะะพะฑะฐะฒััะต ะฟัะฝะบั 15 ะฒ `ha` ัะบัะธะฟั:

```bash
# ะะพัะปะต ะฟัะฝะบัะฐ 14
15)
    echo "๐ n8n - ะฃะฟัะฐะฒะปะตะฝะธะต..."
    echo ""
    echo "  1) ะัะพะฒะตัะธัั ะฟะพะดะบะปััะตะฝะธะต"
    echo "  2) ะกะฟะธัะพะบ workflows"
    echo "  3) ะะผะฟะพััะธัะพะฒะฐัั workflow"
    echo "  0) ะะฐะทะฐะด"
    echo ""
    read -p "ะัะฑะตัะธัะต (0-3): " -n 1 -r n8n_choice

    case $n8n_choice in
        1)
            "${SCRIPT_DIR}/check_n8n.sh"
            ;;
        2)
            echo "๐ ะกะฟะธัะพะบ workflows ะฒ n8n..."
            # TODO: ัะบัะธะฟั ะดะปั ะฟะพะปััะตะฝะธั ัะฟะธัะบะฐ
            ;;
        3)
            echo "๐ฅ ะะผะฟะพัั workflow..."
            # TODO: ัะบัะธะฟั ะดะปั ะธะผะฟะพััะฐ
            ;;
    esac
    ;;
```

---

## ๐ก Best Practices

### 1. ะะตะทะพะฟะฐัะฝะพััั

**Long-Lived Token:**

- โ ะกะพะทะดะฐะนัะต ะพัะดะตะปัะฝัะน ัะพะบะตะฝ ะดะปั n8n
- โ ะฅัะฐะฝะธัะต ะฒ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั n8n
- โ ะะตะณัะปััะฝะพ ัะพัะธััะนัะต (ัะฐะท ะฒ 6 ะผะตัััะตะฒ)

**Firewall:**

```bash
# ะะฐ Proxmox ัะฐะทัะตัะธัั ัะพะปัะบะพ ะปะพะบะฐะปัะฝัั ัะตัั
iptables -A INPUT -p tcp --dport 5678 -s 192.168.1.0/24 -j ACCEPT
iptables -A INPUT -p tcp --dport 5678 -j DROP
```

### 2. ะะพะฝะธัะพัะธะฝะณ

ะกะพะทะดะฐะนัะต workflow "Monitor n8n":

- ะัะพะฒะตัะบะฐ execution history
- ะะปะตัั ะฟัะธ ัะฐัััั ะพัะธะฑะบะฐั
- ะกัะฐัะธััะธะบะฐ ะฟะพ workflows

### 3. ะัะบะฐะฟั n8n

n8n ััะฐะฝะธั workflows ะฒ SQLite/PostgreSQL:

```bash
# ะัะบะฐะฟ workflows (JSON export)
docker exec n8n n8n export:workflow --all --output=/backup/workflows.json

# ะะปะธ ะฒ UI: Settings โ Export all workflows
```

---

## ๐ ะขะธะฟะธัะฝัะต ะฟัะพะฑะปะตะผั

### ะัะพะฑะปะตะผะฐ: "Connection refused"

**ะัะธัะธะฝะฐ:** Firewall ะธะปะธ ะฝะตะฒะตัะฝัะน IP

**ะะตัะตะฝะธะต:**

```bash
# ะัะพะฒะตัะธัั ััะพ n8n ัะปััะฐะตั
netstat -tulpn | grep 5678

# Ping n8n
ping 192.168.1.50

# Curl test
curl http://192.168.1.50:5678/healthz
```

### ะัะพะฑะปะตะผะฐ: "Unauthorized"

**ะัะธัะธะฝะฐ:** ะะตะฒะตัะฝัะน HA token ะธะปะธ credential

**ะะตัะตะฝะธะต:**

1. ะะตัะตัะพะทะดะฐะนัะต Long-Lived Token ะฒ HA
2. ะะฑะฝะพะฒะธัะต credential ะฒ n8n
3. ะัะพัะตััะธััะนัะต ัะฝะพะฒะฐ

### ะัะพะฑะปะตะผะฐ: "Workflow ะฝะต ััะฐะฑะฐััะฒะฐะตั"

**Checklist:**

- โ Workflow ะฐะบัะธะฒะธัะพะฒะฐะฝ? (toggle ะฒ ON)
- โ Webhook URL ะฟัะฐะฒะธะปัะฝัะน?
- โ HA automation ะฝะฐัััะพะตะฝะฐ?
- โ ะัะพะฒะตัััะต Execution Log ะฒ n8n

---

## ๐ ะะพะปะตะทะฝัะต ัััะปะบะธ

- [n8n Documentation](https://docs.n8n.io/)
- [Home Assistant node](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.homeassistant/)
- [AI Agents ะฒ n8n](https://docs.n8n.io/advanced-ai/)
- [Community workflows](https://n8n.io/workflows/?categories=home-automation)

---

**ะะฐัะฝะธัะต ั ัะตััะพะฒะพะณะพ workflow, ะทะฐัะตะผ ะดะพะฑะฐะฒะปัะนัะต ะฟะพ ะพะดะฝะพะผั ะบะฐะถะดัะต 2-3 ะดะฝั!**
