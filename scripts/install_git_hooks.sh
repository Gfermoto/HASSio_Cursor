#!/bin/bash
# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Git hooks Ð´Ð»Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸

# ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ ÐºÐ¾Ñ€ÐµÐ½ÑŒ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"

echo "ðŸ”§ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Git hooks..."
echo ""

# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ñ‡Ñ‚Ð¾ Git Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½
if [ ! -d "$PROJECT_ROOT/.git" ]; then
    echo "âŒ Git Ð½Ðµ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½!"
    echo "Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ: git init"
    exit 1
fi

# Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ pre-commit hook
PRE_COMMIT_HOOK="$PROJECT_ROOT/.git/hooks/pre-commit"

cat > "$PRE_COMMIT_HOOK" << 'EOF'
#!/bin/bash
# Pre-commit hook: Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸

echo ""
echo "ðŸ” Pre-commit: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸..."
echo ""

# Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÑƒ
./scripts/check_security.sh

RESULT=$?

if [ $RESULT -ne 0 ]; then
    echo ""
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘  âŒ ÐšÐžÐœÐœÐ˜Ð¢ ÐžÐ¢ÐœÐ•ÐÐÐ Ð¸Ð·-Ð·Ð° Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸  â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo ""
    echo "Ð˜ÑÐ¿Ñ€Ð°Ð²ÑŒÑ‚Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ð¸ Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÑÐ½Ð¾Ð²Ð°."
    echo ""
    exit 1
fi

echo ""
echo "âœ… ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸ Ð¿Ñ€Ð¾Ð¹Ð´ÐµÐ½Ð°. ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð°ÐµÐ¼ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚..."
echo ""

exit 0
EOF

chmod +x "$PRE_COMMIT_HOOK"

echo "âœ… Pre-commit hook ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½!"
echo ""
echo "Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð¿ÐµÑ€ÐµÐ´ ÐšÐÐ–Ð”Ð«Ðœ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð¾Ð¼ Ð±ÑƒÐ´ÐµÑ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸:"
echo "  1. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÑ‚ÑŒÑÑ .gitignore"
echo "  2. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÑ‚ÑŒÑÑ Ñ‡Ñ‚Ð¾ config.yml Ð½Ðµ Ð² staged"
echo "  3. Ð˜ÑÐºÐ°Ñ‚ÑŒÑÑ ÑƒÑ‚ÐµÑ‡ÐºÐ¸ IP/Ð¿Ð°Ñ€Ð¾Ð»ÐµÐ¹/Ñ‚Ð¾ÐºÐµÐ½Ð¾Ð²"
echo "  4. Ð‘Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒÑÑ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚ Ð¿Ñ€Ð¸ Ð¾Ð±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ð¸Ð¸ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼"
echo ""
echo "ðŸ’¡ ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ:"
echo "   ./scripts/check_security.sh"
echo ""
echo "ðŸŽ‰ Ð“Ð¾Ñ‚Ð¾Ð²Ð¾! Ð¢ÐµÐ¿ÐµÑ€ÑŒ Git Ð·Ð°Ñ‰Ð¸Ñ‚Ð¸Ñ‚ Ð²Ð°Ñ Ð¾Ñ‚ ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ñ‹Ñ… ÑƒÑ‚ÐµÑ‡ÐµÐº."
echo ""
